<?php
/**
 * Magedelight
 * Copyright (C) 2019 Magedelight <info@magedelight.com>
 *
 * @category Magedelight
 * @package Magedelight_Vendor
 * @copyright Copyright (c) 2019 Mage Delight (http://www.magedelight.com/)
 * @license http://opensource.org/licenses/gpl-3.0.html GNU General Public License,version 3 (GPL-3.0)
 * @author Magedelight <info@magedelight.com>
 */

/** @var $block Magedelight\Vendor\Block\Review\Customer\Review\Grid */
$reviews = $block->getCollection();
?>
<form method="get" action="<?= $block->getSubmitUrl() ?>" id="vendor-ratings-search" name="vendor_ratings_search" >
    <div class="row">
        <div class="row-gutter toolbar-wrapper mb10">
            <div class="col-xs-4">
                <input type="hidden" name="tab" value="<?= $this->getRequest()->getParam('tab', '3,0') ?>">            
                <input id="sort-order" type="hidden" name="sort_order" value="<?= $this->getRequest()->getParam('sort_order', 'created_at') ?>">
                <input id="sort-direction" type="hidden" name="dir" value="<?= $this->getRequest()->getParam('dir', 'DESC') ?>">
                <div class="block block-search">
                    <div class="content">
                        <div class="field search-catalog">
                            <div class="control">
                                <input placeholder="<?= __('Search...') ?>" type="text" value="<?= $this->getRequest()->getParam('q') ?>" name="q" id="vendor_order_search" class="input-text vendor search-order-input">
                            </div>
                            <div class="actions">
                                <div class="vendor primary"><button type="submit" class="vendor action login primary"><span>Search</span></button></div>
                            </div>
                        </div>
                    </div>
                </div>            
            </div>
                        <div class="col-xs-8">
                <div class="row">
                    <div class="col-xs-3 pt10">
                        <a rel="new" href="javascript:void(0)" class="action-reset search"><?= __('Reset') ?></a>
                        </div>
                     <div class="col-xs-9">
                             <div class="toolbar-filter-wrapper">
                              <div class="topbar-right col-xs-12">
                                              <div class="data-grid-filters-actions-wrap">
                                                  <div class="data-grid-filters-action-wrap">
                                                      <span class="clear-filters mr10"><a rel="new" href="javascript:void(0)" class="action action-reset filter"><?= __('Clear') ?></a></span>
                                                      <button class="action secondary action-default _active" type="button" data-action="grid-filter-expand" title="Filters">
                                                          <span><?= __('Filters') ?></span>
                                                      </button>
                                                  </div>
                                              </div>
                                 </div>
                        </div>
                        </div>
                    </div>
                </div>


        </div>
    </div>
    <div class="filter-wrapper" style="display:none;">    
        <fieldset class="row fieldset">
            <div class="row-gutter filter-row">
                <div class="col-md-6 col-lg-3 filter-section">
                    <fieldset class="fieldset">
                        <legend class="legend">
                            <span class=""><?= __('Id') ?></span>
                        </legend>
                        <div class="field">
                            <label class="label" for="id_from">
                                <span><?= __('from') ?></span>
                            </label>
                            <div class="control">
                                <input class="input-text" 
                                       type="text"  
                                       name="id[from]"
                                       id="id_from" 
                                       value="<?= $this->getRequest()->getParam('id')['from'] ?>">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label" for="id_to">
                                <span><?= __('to') ?></span>
                            </label>
                            <div class="control">
                                <input class="input-text" 
                                       type="text"  
                                       name="id[to]"                                        
                                       id="id_to" 
                                       value="<?= $this->getRequest()->getParam('id')['to'] ?>">
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div class="col-md-6 col-lg-3 filter-section">
                    <fieldset class="fieldset">
                        <legend class="legend">
                            <span class=""><?= __('Order Id') ?></span>
                        </legend>
                        <div class="field">
                            <label class="label" for="vendor_order_id_from">
                                <span><?= __('from') ?></span>
                            </label>
                            <div class="control">
                                <input class="input-text" 
                                       type="text"  
                                       name="vendor_order_id[from]"
                                       id="vendor_order_id_from" 
                                       value="<?= $this->getRequest()->getParam('vendor_order_id')['from'] ?>">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label" for="vendor_order_id_to">
                                <span><?= __('to') ?></span>
                            </label>
                            <div class="control">
                                <input class="input-text" 
                                       type="text"  
                                       name="vendor_order_id[to]"                                        
                                       id="vendor_order_id_to" 
                                       value="<?= $this->getRequest()->getParam('vendor_order_id')['to'] ?>">
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div class="col-md-6 col-lg-3 filter-section">
                    <fieldset class="fieldset">
                        <legend class="legend">
                            <span class=""><?= __('Ratings') ?></span>
                        </legend>
                        <div class="field">
                            <label class="label" for="">
                                <span><?= __('from') ?></span>
                            </label>
                            <div class="control">
                                <input class="input-text" 
                                       type="text"  
                                       name="ratings[from]"
                                       id="ratings_from" 
                                       value="<?= $this->getRequest()->getParam('ratings')['from'] ?>">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label" for="ratings_to">
                                <span><?= __('to') ?></span>
                            </label>
                            <div class="control">
                                <input class="input-text" 
                                       type="text"  
                                       name="ratings[to]"                                        
                                       id="ratings_to" 
                                       value="<?= $this->getRequest()->getParam('ratings')['to'] ?>">
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div class="col-md-6 col-lg-3 filter-section">
                    <fieldset class="fieldset" id="created_date_range">
                        <legend class="legend">
                            <span class=""><?= __('Date') ?></span>
                        </legend>
                        <div class="field">
                            <label class="label" for="date_from">
                                <span><?= __('from') ?></span>
                            </label>
                            <div class="control date-control date-field-container">
                                <input class="input-text" 
                                       type="text"  
                                       name="created_at[from]"  
                                       placeholder="MM/DD/YYYY"
                                       readonly="readonly"
                                       id="created_date_from" 
                                       value="<?= $this->getRequest()->getParam('created_at')['from'] ?>">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label" for="date_to">
                                <span><?= __('to') ?></span>
                            </label>
                            <div class="control date-control date-field-container">
                                <input class="input-text"
                                       type="text"  
                                       name="created_at[to]"  
                                       placeholder="MM/DD/YYYY"
                                       readonly="readonly"
                                       id="created_date_to" 
                                       value="<?= $this->getRequest()->getParam('created_at')['to'] ?>">
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class="row-gutter filter-row">
                <div class="col-md-6 col-lg-3 filter-section">
                    <fieldset class="fieldset field-full-width">
                        <legend class="legend">
                            <span class=""><?= __('Customer Name') ?></span>
                        </legend>
                        <div class="field">
                            <div class="control">
                                <input class="input-text" type="text" name="customer_name" id="customer_name" value="<?= trim($this->getRequest()->getParam('customer_name')) ?>">
                            </div>
                        </div>
                    </fieldset>
                </div>
                
            </div>
        </fieldset>
        <div class="row">
        <div class="row-gutter">
            <div class="filters-footer col-md-12">
                <div class="action-toolbar main-actions">
                    <button class="action primary grid-filter-cancel cancel" type="reset" data-action="grid-filter-cancel" >
                        <span><?= __('Cancel') ?></span>
                    </button>
                    <button class="action primary" type="submit" data-action="grid-filter-apply" >
                        <span><?= __('Apply') ?></span>
                    </button>
                </div>
            </div>
        </div>
        </div>
    </div>
</form>
<div class="table-wrapper ratings-summary">
    <table class="data table table-ratings-items history" id="ratings-table">
        <thead>
            <tr>
                <th scope="col" sortorder="created_at" class="col date sortable"><?= __('Date') ?></th>
                <th scope="col" class="col message-content"><?= __('Review Message') ?></th>
                <th scope="col" sortorder="increment_id" class="col increment_id sortable"><?= __('Order Id') ?></th>
                <th scope="col" sortorder="rating_avg" class="col rating_avg sortable"><?= __('Ratings') ?></th>
                <th scope="col" sortorder="customer_name" class="col customer_name"><?= __('Customer') ?></th>                        
                <th scope="col" sortorder="action" class="col actions"><?= __('Action') ?></th>
            </tr>
        </thead>
        <tbody>  
                <?php if ($reviews && count($reviews)) { ?>
                    <?php foreach ($reviews as $_review) : ?>
                    <tr>
                        <td class="col data-grid-date-cell"><div class="data-grid-cell-content"><?= $block->dateFormat($_review->getCreatedAt()) ?></div></td>
                        <td class="col data-grid-comment-cell"><div class="data-grid-cell-content"><?= $_review->getComment() ?></div></td>
                        <td class="col data-grid-id-cell"><div class="data-grid-cell-content"><?= $_review->getIncrementId() ?></div></td></td>
                        <td class="col data-grid-rating-cell">
                        <?php if ($_review->getRatingAvg() == 0) :
                            ?><?php $ratImage = 0; ?><?php
                        else :
                            ?><?php $ratImage = $_review->getRatingAvg() ?><?php
                        endif; ?>
                            <div class="rating-summary vender-display-list">
                                <?php /* <div class="seller-rating-container ">
                                  <span class="seller-rating"><?= __("<span> %1 </span> /5", ($ratImage * 5 / 100)) ?></span>
                                  </div> */ ?>
                                <div class="rating-result" title="<?= $ratImage; ?>%">  
                                    <span style="width:<?= $ratImage; ?>%">
                                        <span>
                                            <span itemprop="ratingValue"><?= $ratImage; ?></span>% of <span itemprop="bestRating">100</span>                                                
                                        </span>
                                    </span>
                                </div>
                            </div>
                        </td>
                        <td class="col data-grid-customer-name"><?= $_review->getCustomerName() ?></td>
                        <td class="col data-grid-actions-cell">
                            <a href="<?= $block->getViewUrl($_review) ?>" class="fancyboxlivevendor">
                                <span><?= __('View') ?></span>
                            </a>                            
                        </td>
                    </tr>
                    <?php endforeach; ?>
                <?php } else { ?>
                <tr><td colspan="6"> <div class="message info empty" id="rating-msg"></div></td></tr>
                <?php } ?>
        </tbody>
    </table>
</div>
<?php if ($block->getPagerHtml()) : ?>
    <div class="order-products-toolbar toolbar bottom"><?= $block->getPagerHtml(); ?></div>
<?php endif ?>
<script>
    require([
            'jquery',
            'domReady!',
            'Magedelight_Theme/js/fancybox'
            ], function ($) {
            $("#vendor_mass_unlist_checkall").change(function () {
                $(".vendor_mass_unlist").prop('checked', $(this).prop("checked"));
            });
            $('.fancyboxlivevendor').fancybox({
                type: 'iframe',
                maxWidth: 800,
                maxHeight: 400,
                fitToView: false,
                width: '70%',
                height: '70%',
                autoSize: false,
                closeClick: false,
                openEffect: 'elastic',
                closeEffect: 'none',
                showCloseButton: true,
                afterShow: function () {
                    $('.fancybox-skin').append('<a title="Close" class="fancybox-item fancybox-close" href="javascript:jQuery.fancybox.close();"></a>');
                }
            });
    });
</script>
<script type="text/javascript">
    require([
        'jquery',
        'mage/calendar',
    ], function ($) {
        $(".filter-wrapper").hide();
        $(".action-default").click(function () {
            $(".filter-wrapper").toggle(500);
        });
        $(".grid-filter-clear-all").click(function () {
            $form = $(this).parents('form');
            $(':input:not([type=hidden])', $form).val("");
            $($form).submit();
        });
        $("#created_date_range").dateRange({
            buttonText: "<?= __('Select Date') ?>",
            showOn: "button",
            from: {
                id: "created_date_from"
            },
            to: {
                id: "created_date_to"
            }
        });
        $(document).ready(function () {
            /*
             * Sorting feature
             */
            $currentSortOrder = $('#sort-order').val();
            $currentSortDir = $('#sort-direction').val();
            
            if ($currentSortOrder != null && $currentSortOrder != '') {                
                $sortDirClass = ($currentSortDir == 'DESC') ? 'descend' : 'ascend';
                 $('th[sortorder="'+$currentSortOrder+'"]').addClass($sortDirClass);
            }
            $sortDir = 'ASC';

            $('#ratings-table .sortable').click(function ($e) { 
                $sortOrder = $(this).attr('sortorder');
                if ($currentSortOrder == $sortOrder) {
                    $sortDir = ($currentSortDir == 'DESC') ? 'ASC' : 'DESC';
                }                
                $('#sort-order').val($sortOrder); /*for post */
                $('#sort-direction').val($sortDir); /*for post */
                $('#vendor-ratings-search').submit();
            });
            
        $(".grid-filter-cancel").click(function () {
            $(this).parents('.filter-wrapper').toggle(500);
        });

        $(".action-reset").click(function () {
            $form = $(this).parents('form');
            if ($(this).hasClass('search')) {
                $parent = $('.block-search', $form);
            } else {
                $parent = $('.filter-wrapper', $form);
            }
            $(':input:not([type=hidden])', $parent).val("");
            $($form).submit();
        });
        
        $value = "false";
                    $('input[type=text]').each(function () {
                        var text_value = $(this).val();
                        if (text_value != '')
                        {
                            $value = "true";
                        }

                    });
                    
                    if (jQuery('#vendor_order_search')[0].value != "" || $value == "true") {
                        jQuery('#rating-msg').html('<span>Your search result could not find</<span>');
                    } else {
                        jQuery('#rating-msg').html('<span>We couldn\'t find any records.</<span>');
                    }
        
        });
    });
</script>