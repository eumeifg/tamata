<?php
/**
 * Magedelight
 * Copyright (C) 2019 Magedelight <info@magedelight.com>
 *
 * @category Magedelight
 * @package Magedelight_Vendor
 * @copyright Copyright (c) 2019 Mage Delight (http://www.magedelight.com/)
 * @license http://opensource.org/licenses/gpl-3.0.html GNU General Public License,version 3 (GPL-3.0)
 * @author Magedelight <info@magedelight.com>
 */

/** @var $this \Magedelight\Vendor\Block\Profile */
$vendor =  $this->getVendor();
$regions = $this->getRegions();
?>
<div id="shipping-info-content" class="row signup-step-content profile-step-content no-display">
    <div class="title">
        <h3><span><?= __('Pickup and Shipping Information') ?></span></h3>
        <span class="edit-link f-right">Edit</span>
    </div>
    <form name="shipping_information_form" id="shipping-information-form" enctype="multipart/form-data" method="post" action="<?= $this->getPostActionUrl('shippinginfo') ?>">
        <fieldset class="fieldset">
            <?php if (!$block->isRemoved('pickup_address1', 'shipping')) { ?>
            <div class="field pickup-address-1 required">
                <label class="label" for="pickup-address1"><span><?= __('Address Line 1') ?></span></label>
                <div class="control _with-tooltip">
                     <input name="pickup_address1" id="pickup-address1" title="<?= __('Address Line 1') ?>" value="<?= $vendor->getPickupAddress1(); ?>" class="input-text required-entry validate-alpha-with-spaces-spl-150" type="text" placeholder="Address Line 1"  />
                     <div class="field-tooltip toggle">
                                    <span class="field-tooltip-action action-help" tabindex="0" hidden="hidden">
                                        
                                    </span>
                                    <div class="field-tooltip-content">
                                         <span><?= __('Enter Address Line 1') ?></span>
                                    </div>
                                </div>
                </div>
            </div>
            <?php } ?>
            
            <?php if (!$block->isRemoved('pickup_address2', 'shipping')) { ?>
            <div class="field pickup-address-2">
                <label class="label" for="pickup-address2"><span><?= __('Address Line 2') ?></span></label>
                <div class="control _with-tooltip">
                     <input name="pickup_address2" id="pickup-address2" title="<?= __('Address Line 2') ?>" value="<?= $vendor->getPickupAddress2(); ?>" class="input-text validate-alpha-with-spaces-spl-150-address2" type="text" placeholder="Address Line 2"  />

                     <div class="field-tooltip toggle">
                                    <span class="field-tooltip-action action-help" tabindex="0" hidden="hidden">
                                        
                                    </span>
                                    <div class="field-tooltip-content">
                                         <span><?= __('Enter Address Line 2') ?></span>
                                    </div>
                                </div>
                </div>
            </div>
            <?php } ?>
            
            <?php if (!$block->isRemoved('pickup_country_id', 'shipping')) { ?>
            <div class="field pickup-country-id">
                <label class="label" for="pickup-country-id"><span><?= __('Country') ?></span></label>
                <div class="control _with-tooltip">
                    <?= $block->getCountryHtmlSelect($vendor->getPickupCountry(), 'pickup_country_id', 'pickup_country') ?>

                    <div class="field-tooltip toggle">
                        <span class="field-tooltip-action action-help" tabindex="0" hidden="hidden"></span>
                        <div class="field-tooltip-content">
                             <span><?= __('Select Country') ?></span>
                        </div>
                    </div>
                </div>
            </div>
            <?php } ?>
            
            <?php if (!$block->isRemoved('pickup_region', 'shipping')) { ?>
            <div class="field pickup_region_id <?= $block->isRegionsRequired() ? ' required' : '' ?>">
                <label class="label" for="pickup_region_id"><span><?= __('State/Region') ?></span></label>
                <div class="control _with-tooltip">
                    <select name="pickup_region_id" id="pickup_region_id" title="<?= __('State/Region') ?>" class="select<?= $block->isRegionsRequired() ? ' validate-select' : '' ?>" type="text" placeholder="<?= __('State/Region') ?>" style="display:<?= (!empty($regions))?'inline-block':'none'; ?>" >
                        <option value=""><?= $block->escapeHtml(__('Please select a region, state or province.')) ?></option>
                    </select>
                    <input name="pickup_region" value="<?= $vendor->getPickupRegion(); ?>" id="pickup_region" title="<?= __('State/Region') ?>" class="input-text validate-alpha-with-spaces-50<?= $block->isRegionsRequired() ? ' required-entry' : '' ?>" type="text" placeholder="<?= __('State/Region') ?>" style="display:<?= (empty($regions))?'inline-block':'none'; ?>"/>
                    <div class="field-tooltip toggle">
                        <span class="field-tooltip-action action-help" tabindex="0" hidden="hidden"></span>
                        <div class="field-tooltip-content">
                             <span><?= __('Select if regions found or enter region name.') ?></span>
                        </div>
                    </div>
                </div>
           </div>
            <?php } ?>
            
            <?php if (!$block->isRemoved('pickup_city', 'shipping')) { ?>
           <div class="field pickup-city required">
               <label class="label" for="pickup-city"><span><?= __('City') ?></span></label>
               <div class="control _with-tooltip">
                   <input name="pickup_city" id="pickup-city" title="<?= __('City') ?>" value="<?= $vendor->getPickupCity(); ?>" class="input-text required-entry validate-alpha-with-spaces-50" type="text" placeholder="<?= __('City') ?>" />
                   <div class="field-tooltip toggle">
                                    <span class="field-tooltip-action action-help" tabindex="0" hidden="hidden">
                                        
                                    </span>
                                    <div class="field-tooltip-content">
                                         <span><?= __('Enter City Name') ?></span>
                                    </div>
                                </div>
               </div>
           </div>
            <?php } ?>
            
            <?php if (!$block->isRemoved('pickup_pincode', 'shipping')) { ?>
            <div class="field pickup-zip<?= $block->isZipRequired() ? ' required' : '' ?>">
               <label class="label" for="pickup-zip"><span><?= __('Pincode') ?></span></label>
               <div class="control _with-tooltip">
                    <input name="pickup_pincode" id="pickup-zip" title="<?= __('Pincode') ?>" value="<?= $vendor->getPickupPincode(); ?>" class="input-text<?= $block->isZipRequired() ? ' required-entry' : '' ?> validate-alpha-with-spaces-10"  type="text" placeholder="Pincode" />   
                            <div class="field-tooltip toggle">
                                    <span class="field-tooltip-action action-help" tabindex="0" hidden="hidden">
                                        
                                    </span>
                                    <div class="field-tooltip-content">
                                         <span><?= __('Enter Pincode') ?></span>
                                    </div>
                                </div>
                </div>
            </div>
            <?php } ?>
            <div class="actions-toolbar">
                <div class="primary">
                    <button type="submit" value="shipping-information-form" title="<?= __('Save') ?>" class="action button primary btn-reset">
                        <span><?= __('Save') ?></span>
                    </button>
                    <button type="reset" title="<?= __('Cancel') ?>" class="action button primary btn-reset">
                        <span><?= __('Cancel') ?></span>
                    </button>

                </div>
            </div>
        </fieldset>
    </form>
</div>
<script type="text/javascript">
    require([
        'jquery', /* jquery Library */
        'jquery/ui', /* Jquery UI Library */
        'mage/mage',
        'mage/translate' /* Magento text translate (Validation message translte as per language) */
    ], function($){
        shippingInfoForm = $('#shipping-information-form');
        shippingInfoForm.mage('validation', {
            ignore: ignore ? ':hidden:not(' + ignore + ')' : ':hidden'
        }).find('input:text').attr('autocomplete', 'off');

                shippingInfoForm = $('#shipping-information-form');
                $.validator.addMethod(
                'validate-alpha-with-spaces-spl-150',
                function (v) {
                    return $.mage.isEmptyNoTrim(v) || /^.{1,150}$/.test(v);
                },
                $.mage.__('Please use less than 150 characters  in this field.')
                );

                shippingInfoForm = $('#shipping-information-form');
                $.validator.addMethod(
                'validate-alpha-with-spaces-spl-150-address2',
                function (v) {
                    return $.mage.isEmptyNoTrim(v) || /^.{0,150}$/.test(v);
                },
                $.mage.__('Please use less than 150 characters  in this field.')
                );

                shippingInfoForm = $('#shipping-information-form');
                $.validator.addMethod(
                'validate-alpha-with-spaces-spl-50',
                function (v) {
                    return $.mage.isEmptyNoTrim(v) || /^.{1,50}$/.test(v);
                },
                $.mage.__('Please use less than 50 characters  in this field.')
                );

                $.validator.addMethod(
                'validate-alpha-with-spaces-50',
                function (v) {
                    return $.mage.isEmptyNoTrim(v) || /^[a-zA-Z ]{1,50}$/.test(v);
                },
                $.mage.__('Allow only alphabate with space,Character limit 50, Not allowed special and numeric value.')
                );

                $.validator.addMethod(
                'validate-alpha-with-spaces-10',
                function (v) {
                    
                    return $.mage.isEmptyNoTrim(v) || /^[a-zA-Z0-9 ]{1,12}$/.test(v);
                },
                $.mage.__('Please use less than 10 characters  in this field, allow only alphanumeric.')
                );

        $(document).ready(function () {
            <?php if ($vendor->getPickupRegionId() != null && $vendor->getPickupRegionId() != '') { ?>
            var $pickupRegionId = '<?= $vendor->getPickupRegionId(); ?>';
            var $pickupCityId = '<?= $vendor->getPickupCity(); ?>';
            $('#pickup-region-id').val($pickupRegionId);
            $('button[type="reset"]',shippingInfoForm).click(function(e){
                e.preventDefault();
                shippingInfoForm.get(0).reset();
                $('#pickup-region-id').val($pickupRegionId);
                if ($('#pickup-city').val() !== $pickupCityId) {
                    $('#pickup-city').val($pickupCityId);
                }
            });
            <?php } ?> 
        });
    });
</script>

<script type="text/x-magento-init">
    {
        "#pickup_country": {
            "regionUpdater": {
                "optionalRegionAllowed": <?= /* @noEscape */ $this->helper(\Magedelight\Vendor\Helper\Data::class)->getConfigValue('general/region/display_all') ? 'true' : 'false' ?>,
                "regionListId": "#pickup_region_id",
                "regionInputId": "#pickup_region",
                "postcodeId": "#pincode",
                "form": "#vendor-registration",
                "regionJson": <?= /* @noEscape */ $this->helper(\Magento\Directory\Helper\Data::class)->getRegionJson() ?>,
                "defaultRegion": "<?= (int) $vendor->getPickupRegionId() ?>",
                "countriesWithOptionalZip": <?= /* @noEscape */ $this->helper(\Magento\Directory\Helper\Data::class)->getCountriesWithOptionalZip(true) ?>,
                "disableRegionSelect": true
            }
        }
    }
</script>